:root {
  /* --- ГЕОМЕТРИЯ --- */
  --rail-thickness: 2px;        /* толщина декоративной рельсы */
  --dock-left-width: 64px;      /* ширина левой док-панели */
  --host-pad-x: 12px;           /* внутренние отступы хоста */
  --stage-padding: 16px;        /* отступы сцены от края окна */
  --gutter-width: 12px;         /* базовый паз в обычном режиме */
  --price-scale-gap: 60px;      /* место под шкалу цен справа */
  --chart-card-radius: 20px;    /* радиус "стеклянной" карточки */
}

.chart-host{
  position: relative;
  --host-pad-x: 16px;
  --dock-left-width: 72px;
  --gutter-width: 32px;     /* стабильный паз в expanded */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */
  --chart-left: calc(var(--host-pad-x) + var(--dock-left-width) + var(--gutter-width));
  --rail-thickness: 6px;
  --toolbar-margin: 4px;
  --rail-gap: calc(var(--rail-thickness) + var(--toolbar-margin));
  --left-slot-min: 220px;
  --toolbar-scrim-height: 84px;
  --toolbar-scrim-start: rgba(245,248,255,1);
  --toolbar-scrim-mid: rgba(245,248,255,.92);
  --toolbar-scrim-end: rgba(245,248,255,0);
}

/* === Expanded: больше воздуха слева === */root {
  /* --- ГЕОМЕТРИЯ --- */
  --rail-thickness: 2px;        /* толщина декоративной рельсы */
  --dock-left-width: 64px;       /* ширина левой док-панели */
  --host-pad-x: 12px;            /* внутренние отступы хоста */
  --stage-padding: 16px;         /* отступы сцены от края окна */
  --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */          /* зазор между доком и карточкой */
  --price-scale-gap: 60px;       /* место под шкалу цен справа */
  --chart-card-radius: 20px;     /* радиус "стеклянной" карточки */
}

.chart-host{
  position: relative;
  --host-pad-x: 16px;
  --dock-left-width: 72px;
  --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */
  --chart-gap-from-rail: 16px;
  --chart-left: calc(var(--host-pad-x) + var(--dock-left-width) + var(--gutter-width));
  --rail-thickness: 6px;
  --toolbar-margin: 4px;
  --rail-gap: calc(var(--rail-thickness) + var(--toolbar-margin));
  --left-slot-min: 220px;
  --toolbar-scrim-height: 84px;
  --toolbar-scrim-start: rgba(245,248,255,1);
  --toolbar-scrim-mid: rgba(245,248,255,.92);
  --toolbar-scrim-end: rgba(245,248,255,0);
}





/* === Expanded: больше воздуха слева === */
.chart-host[data-expanded="1"]{
  --host-pad-x: 16px;      /* правый внешний отступ капсулы/сцены */
  --dock-left-width: 72px; /* ширина левой док-панели */
  --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */   /* расширяем среднюю колонку для бейджа */
  --dock-rail-width: 6px;
  --rail-thickness: 6px;
  --toolbar-margin: 4px;
  --rail-gap: calc(var(--rail-thickness) + var(--toolbar-margin));
  --chart-left: calc(
    var(--host-pad-x)
    + var(--dock-left-width)
    + var(--gutter-width)
  );
  padding: 0 var(--host-pad-x);
}


@media (max-width: 1439px){
  .chart-host{
  position: relative;
  --host-pad-x: 16px;
  --dock-left-width: 72px;
  --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */
  --chart-gap-from-rail: 16px;
  --chart-left: calc(var(--host-pad-x) + var(--dock-left-width) + var(--gutter-width));
  --rail-thickness: 6px;
  --toolbar-margin: 4px;
  --rail-gap: calc(var(--rail-thickness) + var(--toolbar-margin));
  --left-slot-min: 220px;
  --toolbar-scrim-height: 84px;
  --toolbar-scrim-start: rgba(245,248,255,1);
  --toolbar-scrim-mid: rgba(245,248,255,.92);
  --toolbar-scrim-end: rgba(245,248,255,0);
}
  .chart-host[data-expanded="1"]{
    --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */
  }
}

@media (max-width: 1279px){
  .chart-host{
  position: relative;
  --host-pad-x: 16px;
  --dock-left-width: 72px;
  --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */
  --chart-gap-from-rail: 16px;
  --chart-left: calc(var(--host-pad-x) + var(--dock-left-width) + var(--gutter-width));
  --rail-thickness: 6px;
  --toolbar-margin: 4px;
  --rail-gap: calc(var(--rail-thickness) + var(--toolbar-margin));
  --left-slot-min: 220px;
  --toolbar-scrim-height: 84px;
  --toolbar-scrim-start: rgba(245,248,255,1);
  --toolbar-scrim-mid: rgba(245,248,255,.92);
  --toolbar-scrim-end: rgba(245,248,255,0);
}
  .chart-host[data-expanded="1"]{
    --gutter-width: 32px;     /* стабильный паз */
  --overlay-gap: 12px;      /* зазор между карточкой и рельсой */
  }
}

/* Вертикальная «рельса» между левой док-панелью и карточкой */
.chart-host .global-rail{
  display: none;
  position: absolute;
  top: 0;
  bottom: 0;
  width: var(--dock-rail-width);
  /* центр \"паза\": host + док + половина gutter; отнимаем половину ширины рельсы */
  left: calc(
    var(--host-pad-x) + var(--dock-left-width)
    + (var(--gutter-width) - var(--dock-rail-width)) / 2
  );
  background: rgba(210, 218, 233, 0.55);
  border-radius: 3px;
  box-shadow: 0 0 0 1px rgba(210,218,233,.06) inset;
  pointer-events: none;
  z-index: 10;
}

.chart-host[data-expanded="1"] .global-rail {
  display: block;
}

/* ОСНОВНАЯ СЦЕНА В РАСШИРЕННОМ РЕЖИМЕ (isExpanded) */
.chart-stage.with-docks {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  padding: var(--stage-padding);
  display: grid;
  grid-template-columns: var(--dock-left-width) var(--gutter-width) 1fr;
  grid-template-rows: 1fr;
  gap: 0;
  background: linear-gradient(180deg, rgba(248, 251, 255, 0.85) 0%, rgba(236, 240, 252, 0.92) 100%);
}

/* ЛЕВАЯ ПАНЕЛЬ ИНСТРУМЕНТОВ */
.chart-stage.with-docks .dock-left {
  grid-column: 1;
  grid-row: 1;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100%;
  width: var(--dock-left-width);
  padding-top: 100px;
}

/* ОБЛАСТЬ ГРАФИКА */
.chart-stage.with-docks .chart-area {
  grid-column: 3;
  grid-row: 1;
  position: relative;
  overflow: hidden;
  background: #ffffff;
  border-radius: var(--chart-card-radius);
  border: 1px solid rgba(216, 222, 235, 0.85);
  box-shadow: 0 20px 36px rgba(18, 24, 42, 0.08); /* Сдвигаем карточку влево */ /* Компенсируем ширину */  /* сдвигаем карточку ближе к рельсе, оставляя зазор */  margin-left: calc(\    -1 * (      ((var(--gutter-width) - var(--dock-rail-width)) / 2) - var(--chart-gap-from-rail)    )  );}
  

/* ВНУТРЕННИЙ КОНТЕЙНЕР CANVAS */
.chart-stage.with-docks .chart-inner {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  padding-right: var(--price-scale-gap);
}

/* ЛОКАЛЬНЫЙ СЕПАРАТОР В СЦЕНЕ (отключаем, т.к. есть глобальная рельса) */
.chart-stage.with-docks .dock-separator {
  position: relative;
  pointer-events: none;
}

.chart-stage.with-docks .dock-sep-left {
  grid-column: 2;
  grid-row: 1;
}

.chart-stage.with-docks .dock-sep-left::before {
  display: none;
}

/* Стекло для карточки графика в expanded */
.chart-card {
  background: linear-gradient(180deg, rgba(255, 255, 255, .72), rgba(255, 255, 255, .64));
  backdrop-filter: blur(10px);
  border: 1px solid rgba(213,218,230,.9); /* hairline */
  border-radius: var(--chart-card-radius);
  box-shadow:
    0 24px 48px rgba(20,24,35,.08),
    0  6px 18px rgba(34,40,60,.08),
    inset 0 1px 0 rgba(255,255,255,.55); /* мягкий внутренний блик */
}

/* В expanded отключаем старую «полосу», чтобы не было дубля */
.chart-stage.with-docks .dock-separator.dock-sep-left::before{
  display: none;
}

/* лёгкий внутренний отступ док-панели, чтобы она визуально не «липла» к рельсе */
.chart-host .dock-left{
  margin-left: calc(var(--host-pad-x) + 12px);
  padding-right: 6px;   /* не влияет на сетку, даёт микрозазор справа внутри колонки */
}

/* Полоса-«scrim» под верхними капсулами */
.chart-host .toolbar-scrim{
  position: absolute;
  top: 0;
  left: var(--chart-left);
  right: var(--host-pad-x);
  height: var(--toolbar-scrim-height);
  background: linear-gradient(
    180deg,
    var(--toolbar-scrim-start) 0%,
    var(--toolbar-scrim-mid)   60%,
    var(--toolbar-scrim-end)   100%
  );
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
  pointer-events: none;
  z-index: 20;
}

/* Переопределение для сдвига панели инструментов */


/* Слои (на всякий случай, чтобы всё было предсказуемо) */
.chart-host .global-rail{ z-index: 10; }
[data-expanded="1"].chart-toolbar{ z-index: 30; }



/* Шапка и слоты в expanded */
.chart-host[data-expanded="1"] .chart-toolbar-section{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 16px 0;
  background: transparent !important;
  border: none !important;
}

.chart-host[data-expanded="1"] .toolbar-left-slot{
  margin-left: var(--host-pad-x);
  min-width: var(--left-slot-min);
  display: flex;
  align-items: flex-start;
  pointer-events: none;
  z-index: 4;
}

.chart-host[data-expanded="1"] .toolbar-left-slot > *{
  pointer-events: auto;
}

.chart-host[data-expanded="1"] .toolbar-right-slot{
  margin-right: var(--host-pad-x);
}









/* На всякий: если оставался макетный левый слот — он не нужен */
.chart-host .toolbar-left-slot{ display: none; }
/* Контейнер оверлея слева: ширина = от левого поля до рельсы минус небольшой зазор */
.chart-host .overlay-left{
  position: absolute;
  top: 12px;
  left: var(--host-pad-x);
  right: calc(100% - var(--chart-left) + var(--overlay-gap));
  display: flex;
  align-items: flex-start;
  pointer-events: none;   /* сам контейнер клики не ловит */
  z-index: 4;            /* выше рельсы (2) и капсулы (3) */
}

/* Сама карточка: интерактивна, ширину не навязываем больше «окна» */
.chart-host .overlay-left .ticker-card{
  pointer-events: auto;
  width: min(260px, 100%);
}


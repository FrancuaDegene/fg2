# Отчёт по доработкам

## Основные изменения
- Инкапсулировали layout графика в `ChartShell` и подключили новый `ChartCanvas`, убрав устаревший `ChartSurface`.
- Подключили единый компонент `Overlay` для поисковой модалки и фонового затемнения.
- Добавили хук `useDropdown` и перевели на него выпадающие меню интервалов и таймфреймов в `ChartToolbar`.
- Вынесли разметку тулбара/сцены в `chart-host` и добавили глобальную вертикальную рельсу с привязкой к токенам.
- Обновили стили expanded-режима: тулбар теперь «капсула», выровненная влево, без подложки, график имеет стеклянную карточку.
- Привели CSS к токенам (`--dock-left-width`, `--gutter-width`, `--host-pad-x`), убрали дубли и артефакты после скриптовых правок.

## Файлы
- `src/components/Results/Chart/ChartRenderer.js`
- `src/components/Results/Chart/ChartShell.js`
- `src/components/Results/Chart/ChartToolbar.js`
- `src/components/Results/Chart/ChartToolbar.css`
- `src/components/Results/Chart/ChartLayout.css`
- `src/components/Overlay/Overlay.js`
- `src/components/SearchModal/SearchModal.js`

## Результат
График в expanded-режиме выглядит как «карточка» с единой вертикальной направляющей; верхняя панель лёгкая, без фона, стоит слева и совпадает с карточкой. Навигационные выпадающие списки управляются единым примитивом, а модальные/фоновые слои используют общий Overlay.

## Изменения 2025-10-05
- Добавили DOM-узел `toolbar-scrim` под верхним тулбаром и усилили слой scrim (градиент, blur, токены высоты).
- Перестроили токены в `ChartLayout.css`: ширина желоба, параметры рельсы, высота scrim, порядок z-index (сцена → рельса → scrim → тулбар).
- Обновили позиционирование рельсы (left, z-index 10) и сместили левую док-панель ближе к краю (`margin-left: calc(var(--host-pad-x) - 30px)` + внутренний padding).
- Для `ChartToolbar.css` закрепили секцию на `position: relative`, добавили псевдослои `::before`/`::after` (шторка + антишов), привязали капсулу к `--chart-left + toolbar-margin`, отключили тени/filters в expanded.
- Привели стили капсулы к прозрачному состоянию, гарантировали что все футеры меню/кнопок без box-shadow/drop-shadow в expanded.

## Проверить
- Expanded-режим: шторка перекрывает фон, строки под тулбаром не просвечивают, рельса остаётся по центру желоба.
- Левый док-инструментов не пересекает рельсу (проверить 1x и 2x масштаб).
- Выпадающие меню и капсула не конфликтуют со scrim (z-index 30).
## Изменения 2025-10-06
- Перевели `TickerCard` в оверлейный слой: карточка рендерится через `overlay-left`, не участвует в сетке и больше не двигает график/капсулу.
- Вернули стабильные токены паза (`--gutter-width: 32px`) и добавили `--overlay-gap`, `--chart-gap-from-rail` для точной настройки зазора между рельсой и карточкой.
- Убрали макетный левый слот тулбара и запретили ему влиять на layout (`display: none`).
- Для верхней панели в expanded-режиме закрепили выравнивание справа, задали фиксированный `margin` и `width: fit-content`; капсула теперь «парит» у рельсы без фоновых подложек.
- Сузили `TickerCard` (220px / 200px на <1360px) и синхронизировали минимальную ширину слота, чтобы карточка корректно вписывалась в окно оверлея.
- Обновили `ChartRenderer.js` для передачи актуальных данных в карточку и удаления left-slot из DOM-сетки.

## Проверить
- Expanded-режим: карточка остаётся слева поверх сцены, при кликах работает `onSearch`, график и тулбар не смещаются.
- При ресайзе до 1440/1280px карточка корректно вписывается в окно, капсула тулбара держится рядом с рельсой.
- На узких экранах убедиться, что скрытый left-slot не оставляет пустых отступов и overlay не перекрывает интерактивные элементы графика.
